<h1>Perfil del Usuario</h1>
<p><strong>Nombre:</strong> {{first_name}}</p>
<p><strong>Apellido:</strong> {{last_name}}</p>
<p><strong>Email:</strong> {{email}}</p>
<p><strong>Edad:</strong> {{age}}</p>
<p><strong>Rol:</strong> {{role}}</p>

<h2>Productos disponibles</h2>

<div>
    <button onclick="redirectToProducts()">Agregar Producto</button>
</div>

<ul>
  {{#each products}}
    <li>
      <h3>{{this.product}}</h3>
      <p>{{this.description}}</p>
      <p>Precio: ${{this.price}}</p>
      <p>Stock: {{this.stock}}</p>
      <p>Categoría: {{this.category}}</p>

      {{#if (eq ../role 'admin')}}
        <!-- Mostrar opciones para el administrador (actualizar y eliminar producto) -->
        <!-- Botón para eliminar producto -->
        <form action="/products/delete/{{this._id}}" method="POST">
          <button type="submit">Eliminar</button>
        </form>
        <!-- Botón para actualizar producto (abre un formulario) -->
        <button onclick="toggleUpdateForm('{{this._id}}')">Actualizar</button>

        <!-- Formulario oculto para actualizar producto -->
        <div id="updateForm-{{this._id}}" style="display:none;">
          <form action="/products/update/{{this._id}}" method="POST">
            <label for="product">Nombre:</label>
            <input type="text" name="product" value="{{this.product}}">
            
            <label for="description">Descripción:</label>
            <input type="text" name="description" value="{{this.description}}">
            
            <label for="price">Precio:</label>
            <input type="number" name="price" value="{{this.price}}">
            
            <label for="stock">Stock:</label>
            <input type="number" name="stock" value="{{this.stock}}">
            
            <label for="category">Categoría:</label>
            <input type="text" name="category" value="{{this.category}}">
            
            <button type="submit">Guardar Cambios</button>
          </form>
        </div>
      {{else}}
        <!-- Mostrar solo la opción de agregar al carrito para usuarios -->
        <form action="/cart/add/{{this._id}}" method="POST">
          <button type="submit">Agregar al carrito</button>
        </form>
      {{/if}}
    </li>
  {{/each}}
</ul>

<script>
  // Función para mostrar/ocultar el formulario de actualización
  const toggleUpdateForm = (productId) => {
    const form = document.getElementById(`updateForm-${productId}`);
    form.style.display = form.style.display === 'none' ? 'block' : 'none';
  }
  
    const redirectToProducts = () => {
    window.location.href = "http://localhost:8080/api/sessions/products";
  }
</script>